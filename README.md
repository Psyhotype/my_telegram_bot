# Telegram Scheduler Bot

Этот бот предназначен для ежедневной отправки расписания в определенную тему (топик) группового чата Telegram.

## Ключевые особенности

- **Привязка к теме:** Бот отправляет сообщения не просто в чат, а в конкретную тему, не засоряя другие обсуждения.
- **Ежедневная отправка:** Автоматически отправляет расписание на текущий день в заданное время (9:00 МСК).
- **Ручной вызов:** Позволяет получить расписание на любой день недели по команде `/schedule`.
- **Обновление "на лету":** Расписание можно изменить в файле `schedule_texts.json`, и бот подхватит изменения без перезапуска.
- **Надежность:** Код построен с учетом отказоустойчивости, использует атомарную запись файлов и корректно обрабатывает ошибки.

## Архитектура

Проект построен с использованием принципа **разделения ответственности (Separation of Concerns)** и **внедрения зависимостей (Dependency Injection)** для повышения тестируемости и поддерживаемости.

- **`main.py`**: Точка входа. Инициализирует все компоненты и запускает бота.
- **`config.py`**: Управляет конфигурацией приложения (токен, пути к файлам и т.д.).
- **`bot_logic.py`**: Содержит основной класс `SchedulerBot`, который управляет логикой Telegram (обработка команд, отправка сообщений).
- **`services/`**: Директория с независимыми сервисами.
  - `storage_service.py`: Отвечает за чтение и атомарную запись данных на диск (информация о привязке, дата последней отправки).
  - `schedule_service.py`: Отвечает за загрузку и кеширование расписания из JSON-файла.

## Установка и запуск

1.  **Создайте файлы проекта** согласно предоставленной структуре.

2.  **Создайте и активируйте виртуальное окружение (рекомендуется):**
    ```bash
    # Для macOS/Linux
    python3 -m venv venv
    source venv/bin/activate

    # Для Windows
    python -m venv venv
    venv\Scripts\activate
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Настройте конфигурацию:**
    - Создайте файл `.env` в корневой директории проекта.
    - Добавьте в него токен вашего бота в следующем формате:
      ```
      BOT_TOKEN="12345:ABC...XYZ"
      ```

5.  **Настройте расписание:**
    - Отредактируйте файл `schedule_texts.json`, добавив свое расписание. Ключи — это дни недели от `"0"` (Понедельник) до `"6"` (Воскресенье).

6.  **Запустите бота:**
    ```bash
    python main.py
    ```

## Как использовать бота в Telegram

1.  Добавьте бота в вашу группу, где включены **Темы (топики)**.
2.  Зайдите в нужную тему.
3.  Напишите команду `/start`. Бот привяжется к этой теме.
4.  Расписание будет приходить в эту тему каждый день в 9:00 по московскому времени.
5.  Используйте команду `/schedule`, чтобы получить меню для выбора дня недели и просмотра расписания вручную.
6.  Чтобы отвязать бота, используйте команду `/stop`.